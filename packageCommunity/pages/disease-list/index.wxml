<view class="container">
  <view class="content">
    <!-- 顶部 Tab（与“话题发布/回复”一致，社区三入口统一至此） -->
    <view class="tabs">
      <view class="tab-item {{active==='disease'?'active':''}}" data-key="disease" bindtap="switchTab">蜂病百科</view>
      <view class="tab-item {{active==='qa'?'active':''}}" data-key="qa" bindtap="switchTab">蜂农提问</view>
      <view class="tab-item {{active==='share'?'active':''}}" data-key="share" bindtap="switchTab">经验分享</view>
    </view>

    <!-- Disease Tab -->
    <block wx:if="{{active==='disease'}}">
      <view class="cells">
        <view class="cell" wx:for="{{diseaseList}}" wx:key="code" bindtap="openDiseaseDetail" data-id="{{item.code}}">
          <view class="cell-main">
            <view class="name">{{item.name}}</view>
            <view class="ename" wx:if="{{item.code}}">{{item.code}}</view>
          </view>
          <view class="badge">{{item.articleCount}}篇</view>
        </view>
      </view>
      <view class="empty" wx:if="{{!dLoading && dLoaded && (!diseaseList || diseaseList.length===0)}}">暂无内容</view>
      <view class="loadmore" wx:if="{{dLoading}}">加载中…</view>
      <view class="nomore" wx:if="{{!dLoading && dLoaded && dNoMore && diseaseList.length>0}}">没有更多了</view>
    </block>

    <!-- QA Tab -->
    <block wx:elif="{{active==='qa'}}">
      <!-- 搜索与筛选占位（可按需启用） -->
      <view class="search">
        <view class="search-box">
          <image class="ico" src="/images/common/search.png"></image>
          <input class="ipt" placeholder="搜索热门话题" disabled />
        </view>
      </view>
      <view class="chips">
        <view
          class="chip {{qaActiveCategory === item.value ? 'active' : ''}}"
          wx:for="{{qaCategories}}"
          wx:key="value"
          data-value="{{item.value}}"
          bindtap="onQaCategoryChange"
        >{{item.label}}</view>
      </view>
      <view class="panel">
        <view class="cells">
          <view class="cell" wx:for="{{qaList}}" wx:key="id" bindtap="openQaDetail" data-id="{{item.id}}">
            <view class="cell-hd">
              <image class="avatar" src="{{item.avatar}}"></image>
            </view>
            <view class="cell-main">
              <view class="row-head">
                <text class="nickname">{{item.authorName}}</text>
                <text class="role-tag" wx:if="{{item.authorRoleLabel}}">{{item.authorRoleLabel}}</text>
                <text class="tag">{{item.category || '问题咨询'}}</text>
              </view>
              <view class="date">{{item.publishedAt || '刚刚'}}</view>
              <view class="bubble">{{item.title}}</view>
              <view class="bubble excerpt" wx:if="{{item.excerpt}}">{{item.excerpt}}</view>
            </view>
            <view class="cell-aside">
              <view class="metric">{{item.replies}}条回复</view>
              <view class="metric">{{item.views}}次浏览</view>
            </view>
          </view>
        </view>
      </view>
      <view class="empty" wx:if="{{qaError}}">{{qaError}}</view>
      <view class="empty" wx:if="{{!qaLoading && qaLoaded && (!qaList || qaList.length===0) && !qaError}}">暂无内容</view>
      <view class="loadmore" wx:if="{{qaLoading}}">加载中…</view>
      <view class="nomore" wx:if="{{!qaLoading && qaLoaded && qaNoMore && qaList.length>0}}">没有更多了</view>
      <view class="fab" bindtap="goQaPost" aria-label="发布问题">＋</view>
    </block>

    <!-- Share Tab -->
    <block wx:elif="{{active==='share'}}">
      <view class="search">
        <view class="search-box">
          <image class="ico" src="/images/common/search.png"></image>
          <input class="ipt" placeholder="搜索热门话题" disabled />
        </view>
      </view>
      <view class="chips">
        <view
          class="chip {{shareActiveCategory === item.value ? 'active' : ''}}"
          wx:for="{{shareCategories}}"
          wx:key="value"
          data-value="{{item.value}}"
          bindtap="onShareCategoryChange"
        >{{item.label}}</view>
      </view>
      <view class="panel">
        <view class="cells">
          <view class="cell" wx:for="{{shareList}}" wx:key="id" bindtap="openShareDetail" data-id="{{item.id}}">
            <view class="cell-hd">
              <image class="avatar" src="{{item.avatar}}"></image>
            </view>
            <view class="cell-main">
              <view class="row-head">
                <text class="nickname">{{item.authorName}}</text>
                <text class="role-tag" wx:if="{{item.authorRoleLabel}}">{{item.authorRoleLabel}}</text>
                <text class="tag">{{item.category || '经验分享'}}</text>
              </view>
              <view class="date">{{item.publishedAt || '刚刚'}}</view>
              <view class="bubble">{{item.title}}</view>
              <view class="bubble excerpt" wx:if="{{item.excerpt}}">{{item.excerpt}}</view>
            </view>
            <view class="cell-aside">
              <view class="metric">{{item.likes}}个点赞</view>
              <view class="metric">{{item.views}}次浏览</view>
            </view>
          </view>
        </view>
      </view>
      <view class="empty" wx:if="{{shareError}}">{{shareError}}</view>
      <view class="empty" wx:if="{{!shareLoading && shareLoaded && (!shareList || shareList.length===0) && !shareError}}">暂无内容</view>
      <view class="loadmore" wx:if="{{shareLoading}}">加载中…</view>
      <view class="nomore" wx:if="{{!shareLoading && shareLoaded && shareNoMore && shareList.length>0}}">没有更多了</view>
      <view class="fab" bindtap="goSharePost" aria-label="发布经验">＋</view>
    </block>
  </view>
</view>
