# AGENTS.md

为在本仓库中协作的代码智能体（Agents）提供统一的工作规范与实施指引。此文件适用于仓库根目录及其全部子目录。

## 项目概览
- 名称：bee-guard 蜜蜂疫病监控平台（微信小程序）
- 形态：现有小程序主工程，内含一个遗留项目目录 `smart-hive-weapp/` 用于组件与经验复用（不可直接路径引用，需复制改造）
- 目标：优先完成前端 UI 与交互闭环，当前阶段直接对接后端 API（不再使用 Mock）。

参考文档：
- 功能与结构规划：`CLAUDE.md`
- UI 规范与色板：`docs/UI-Palette-and-Usage.md`
- 需求细化（文本）：`docs/1.txt`, `docs/2.txt`

## 工作原则（必须遵守）
- 接口直连：当前阶段默认走真实后端接口，不使用 Mock 数据或延时 Promise 模拟网络。
- 复用优先：从 `smart-hive-weapp/` 复制可复用组件（如 `ec-canvas`、工具函数），复制后按需适配，不直接引用旧路径。
- 改动聚焦：仅为完成当前任务所需而改动文件，不随意重构无关模块或全局结构。
- 保持一致：遵循全局样式（`app.wxss` 中的 u-btn 系列与色板）与现有代码风格、命名约定与目录组织。
- 可回滚：对导航与配置的修改（`app.json`、路由）需保持最小侵入，确保可快速回退。
- 不引入新依赖：除非产品/维护者明确同意；优先使用小程序原生能力与现有依赖（如 ECharts）。

## 目录与架构约定
- 主包（TabBar）：保留首页、检测、疫情入口、我的，以及结果查询与认证页面。
- 分包策略（建议）：
  - packageKnowledge：知识库相关页面
  - packageCommunity：社区互动（问答/经验分享）
  - packageCharts：疫情地图与可视化（内置 `ec-canvas` 与 `echarts.js`）
  - 注意：TabBar 页必须在主包；公共工具与样式放主包以避免重复打包。
- 资源：静态图片放置于 `images/`；避免在分包内重复拷贝大体积资源。

## 页面开发规范
- 页面文件四件套：`index.wxml` / `index.wxss` / `index.js` / `index.json`。
- 导航：
  - Tab 页使用 `switchTab`；非 Tab 页使用 `navigateTo`，返回使用 `navigateBack`。
  - 新增页面需在 `app.json`（主包或 `subpackages`）登记。
- 文案与语言：面向中文用户，保持描述清晰、友好、一致。
- 组件引用：
  - ECharts：从 `smart-hive-weapp/ec-canvas` 复制（或复用现有）`ec-canvas` 与 `echarts.js` 到目标包（建议图表分包）。
- 样式：
  - 优先使用 `app.wxss` 中的全局工具类（`u-btn`, `u-btn-primary`, `u-btn--md` 等）与色板（`color-primary` 等）。
  - 页面私有样式命名采用短横线命名（kebab-case），避免与全局类冲突。

## 网络与服务层约定（现阶段）
- 所有页面与服务优先对接真实后端接口，遵循现有 `utils/api.js` 与 `services/*` 的封装方式。
- 个别接口未就绪时，可在页面内以最小占位与友好提示过渡；不统一引入 Mock 数据层。
- 登录方式：以“微信手机号一键登录”为准；不再规划或实现“短信验证码登录”流程。

## 优先级与里程碑（面向 UI 验证）
- P0 必须（当前阶段应完成）
  - 检测闭环：检测号验证（前端校验）→ 问卷 → 邮寄说明 → 审核状态（全链路 UI）
  - 自费检测：套餐选择 → 扫码支付 → 凭证上传 → 审核状态（全链路 UI）
  - 结果查询：登录入口（微信一键登录）→ 列表（分页/检索）→ 详情（病种结果、推荐展示与跳转占位）
- P1 增强
  - 疫情可视化：引入 ECharts（ec-canvas），省/市/县维度选择，病种分布与时间趋势图（真实或联调数据）
  - 分包：搭建知识库与社区分包骨架、空态与审核状态展示，上传组件 UI 占位
- P2 后续
  - 推送、PDF 导出/分享、企业专区与活动位等

## 安全与合规（前端侧）
- 检测号“单次使用”与“手机号绑定”由后端实现；前端仅做 UI 与提示，联调以后端返回为准。
- 图片/视频上传：当前阶段仅使用 `chooseImage`/`chooseMedia` 本地预览与占位；不得收集或上传真实隐私数据。
- 不要在仓库中存放密钥、AppID 私密信息或后端地址凭据。

## 代码风格与质量
- JavaScript：
  - 使用 `const`/`let`；避免一字母变量名；函数命名动宾短语（如 `verifyAndStartDetection`）。
  - 避免在代码中加入大段注释或版权声明；必要时以简短块注释说明复杂逻辑。
- WXSS：
  - 尽量模块化，避免污染全局；遵循现有页面命名风格（如 `home-xxx`、`detection-card`）。
- JSON 配置：
  - 新增页面时最小化配置项，仅添加必要字段；组件路径使用相对或包内路径。

## 提交流程与工具（在本开发环境中）
- 使用 `apply_patch` 修改文件（一次性补丁），避免冗余重复读取。
- 复杂任务使用 `update_plan` 维护任务步骤，逐步标记 `in_progress` 与 `completed`，便于协作与回溯。
- 读取大文件分段查看（≤250 行），避免超出终端限制。
- 不进行 `git commit/branch` 操作，除非用户/维护者明确要求。

## 变更影响点清单（新增/修改前自查）
- 路由：是否需要更新 `app.json`（主包或 `subpackages`）？
- TabBar：是否涉及 Tab 页？若是，必须在主包。
- 依赖：是否新增了 `usingComponents` 或第三方库？（优先复用已有）
- 资源：是否新增大图/视频？资源体积与加载方式是否合理？
- 可回退：是否保留了原逻辑入口与 UI？

## 接收标准（当前阶段）
- 主要用户路径可完全点击演示，状态切换自然，空态/错误态可复现。
- UI 风格与交互一致，按钮与表单样式统一使用全局工具类。
- 测试数据覆盖核心分支：企业赠送 vs 自费、支付成功 vs 失败、记录有/无推荐（以真实后端或联调环境验证）。
- 代码最小变更，遵循上述规范，必要的文档或注释到位。

---
维护者注：当前阶段已对接后端接口。如需调整接口规范，将补充 `utils/api.js`、`services/*`、支付与登录的正式接入规范与验收清单。
