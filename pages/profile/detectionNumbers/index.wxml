<view class="detection-numbers">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading" wx:if="{{loading}}">
    <view class="spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- å†…å®¹åŒºåŸŸ -->
  <view class="content" wx:else>
    <!-- ç»Ÿè®¡ä¿¡æ¯ -->
    <view class="stats-card">
      <view class="stats-header">
        <text class="stats-title">ğŸ“Š æˆ‘çš„æ£€æµ‹å·ç»Ÿè®¡</text>
      </view>
      <view class="stats-content">
        <view class="stat-item">
          <text class="stat-number">{{stats.total}}</text>
          <text class="stat-label">æ€»æ•°</text>
        </view>
        <view class="stat-divider"></view>
        <view class="stat-item">
          <text class="stat-number">{{stats.assigned}}</text>
          <text class="stat-label">å¯ç”¨</text>
        </view>
        <view class="stat-divider"></view>
        <view class="stat-item">
          <text class="stat-number">{{stats.used}}</text>
          <text class="stat-label">å·²ç”¨</text>
        </view>
        <view class="stat-divider"></view>
        <view class="stat-item">
          <text class="stat-number">{{stats.expired}}</text>
          <text class="stat-label">è¿‡æœŸ</text>
        </view>
      </view>
    </view>

    <!-- æ£€æµ‹å·åˆ—è¡¨ -->
    <view class="numbers-list" wx:if="{{!isEmpty}}">
      <!-- å¯ç”¨æ£€æµ‹å· -->
      <view class="section" wx:if="{{assignedNumbers.length > 0}}">
        <view class="section-title">ğŸŸ¢ å¯ä½¿ç”¨çš„æ£€æµ‹å·</view>
        <view class="number-card" wx:for="{{assignedNumbers}}" wx:key="full_code">
          <view class="card-header">
            <view class="number-info">
              <text class="number-id">{{item.full_code}}</text>
              <view class="status-badge" style="background-color: #07c160;">
                å¯ä½¿ç”¨
              </view>
            </view>
          </view>
          <view class="card-content">
            <text class="package-name">{{item.displaySourceType}}</text>
            <text class="time-info">åˆ†é…æ—¶é—´ï¼š{{item.assignedAtText}}</text>
          </view>
          <view class="card-actions">
            <button class="action-btn secondary"
                    bindtap="copyNumber"
                    data-number="{{item.full_code}}"
                    data-status="{{item.status}}">
              å¤åˆ¶
            </button>
            <button class="action-btn primary"
                    bindtap="startDetection"
                    data-number="{{item.full_code}}">
              ç«‹å³æ£€æµ‹
            </button>
          </view>
        </view>
      </view>

      <!-- å·²ä½¿ç”¨æ£€æµ‹å· -->
      <view class="section" wx:if="{{usedNumbers.length > 0}}">
        <view class="section-title">âš« å·²å®Œæˆçš„æ£€æµ‹å·</view>
        <view class="number-card" wx:for="{{usedNumbers}}" wx:key="full_code">
          <view class="card-header">
            <view class="number-info">
              <text class="number-id">{{item.full_code}}</text>
              <view class="status-badge" style="background-color: #6b7280;">
                å·²å®Œæˆ
              </view>
            </view>
          </view>
          <view class="card-content">
            <text class="package-name">{{item.displaySourceType}}</text>
            <text class="time-info">ä½¿ç”¨æ—¶é—´ï¼š{{item.usedAtText}}</text>
          </view>
          <view class="card-actions">
            <button class="action-btn secondary"
                    bindtap="copyNumber"
                    data-number="{{item.full_code}}"
                    data-status="{{item.status}}">
              å¤åˆ¶
            </button>
            <button class="action-btn primary"
                    bindtap="viewReport"
                    data-number="{{item.full_code}}">
              æŸ¥çœ‹æŠ¥å‘Š
            </button>
          </view>
        </view>
      </view>

      <!-- å·²è¿‡æœŸæ£€æµ‹å· -->
      <view class="section" wx:if="{{expiredNumbers.length > 0}}">
        <view class="section-title">ğŸ”´ å·²è¿‡æœŸçš„æ£€æµ‹å·</view>
        <view class="number-card" wx:for="{{expiredNumbers}}" wx:key="full_code">
          <view class="card-header">
            <view class="number-info">
              <text class="number-id">{{item.full_code}}</text>
              <view class="status-badge" style="background-color: #ff4d4f;">
                å·²è¿‡æœŸ
              </view>
            </view>
          </view>
          <view class="card-content">
            <text class="package-name">{{item.displaySourceType}}</text>
            <text class="time-info expired">å·²è¿‡æœŸ</text>
          </view>
          <view class="card-actions">
            <button class="action-btn secondary"
                    bindtap="copyNumber"
                    data-number="{{item.full_code}}"
                    data-status="{{item.status}}">
              å¤åˆ¶
            </button>
            <button class="action-btn disabled" disabled>
              å·²è¿‡æœŸ
            </button>
          </view>
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:else>
      <image class="empty-icon" src="https://dtm123.com:7803/targets/image/images/warn.png"></image>
      <text class="empty-title">æš‚æ— æ£€æµ‹å·</text>
      <text class="empty-desc">è¯·è”ç³»ç®¡ç†å‘˜åˆ†é…æ£€æµ‹å·</text>
    </view>
  </view>
</view>
