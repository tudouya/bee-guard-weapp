<view class="container">
  <view class="content">
    <view class="card">
      <view class="header">
        <text class="title">检测结果详情</text>
        <text class="subtitle">检测码：{{detail && detail.detectionId || '—'}}</text>
      </view>

      <view class="section">
        <view class="section-title">基础信息</view>
        <view class="row"><text>样品编号：</text><text class="row-value {{meta.sampleNo ? '' : 'row-value--pending'}}">{{meta.sampleNo || '待录入'}}</text></view>
        <view class="row"><text>姓名：</text><text>{{meta.contactName || '—'}}</text></view>
        <view class="row"><text>取样时间：</text><text>{{meta.sampleTime || '—'}}</text></view>
        <view class="row"><text>地址：</text><text class="ellipsis">{{meta.address || '—'}}</text></view>
        <view class="row"><text>提交时间：</text><text>{{detail && detail.submitTime || '—'}}</text></view>
        <view class="row"><text>报告时间：</text><text>{{detail && detail.reportedAt || '—'}}</text></view>
        <view class="row"><text>状态：</text><text class="status status-{{detail && detail.status}}">{{detail && detail.statusText || '—'}}</text></view>
      </view>

      <view class="section" wx:if="{{detail && detail.status === 'completed'}}">
        <view class="section-title">结果矩阵</view>
        <view class="group-tabs" wx:if="{{tables && tables.length > 1}}">
          <view
            class="group-tab {{activeGroup === item.key ? 'group-tab--active' : ''}}"
            wx:for="{{tables}}"
            wx:key="key"
            data-key="{{item.key}}"
            bindtap="switchGroup"
          >
            {{item.title}}
          </view>
        </view>
        <block wx:for="{{tables}}" wx:key="key">
          <view wx:if="{{activeGroup === item.key}}">
            <view class="group-list">
              <view class="group-row" wx:for="{{item.items}}" wx:key="code">
                <text class="group-name">{{item.displayName}}</text>
                <text class="level-badge level-{{item.badge}}">{{item.badgeText}}</text>
              </view>
            </view>
          </view>
        </block>
      </view>

      <view class="section pending-tip" wx:if="{{!(detail && detail.status === 'completed')}}">
        <view class="section-title">检测进度</view>
        <view class="pending-box">
          <text class="pending-title">检测进行中</text>
          <text class="pending-text">实验室正在处理样品，完成后将第一时间通过小程序通知您。</text>
          <button wx:if="{{detail && detail.status === 'pending'}}" class="u-btn u-btn-primary u-btn--md u-btn--pill u-btn-block" bindtap="goGuide">查看邮寄说明</button>
        </view>
      </view>

      <!-- 推荐（预留） -->
      <view class="section" wx:if="{{recs && recs.length}}">
        <view class="section-title">推荐</view>
        <view class="promo-box" wx:for="{{recs}}" wx:key="index" bindtap="onTapRec" data-index="{{index}}">
          <text class="rec-badge">{{item.source==='enterprise' ? '企业推荐' : '平台推荐'}}</text>
          <text class="rec-name">{{item.productName}}</text>
          <text class="rec-brief">{{item.brief}}</text>
        </view>
      </view>

    </view>
  </view>
</view>
