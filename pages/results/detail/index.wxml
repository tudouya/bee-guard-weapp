<view class="container">
  <view class="content">
    <view class="card">
      <view class="header">
        <text class="title">检测结果详情</text>
        <text class="subtitle">检测码：{{detail && detail.detectionId || '—'}}</text>
      </view>

      <view class="section">
        <view class="section-title">基础信息</view>
        <view class="row"><text>样品编号：</text><text class="row-value {{meta.sampleNo ? '' : 'row-value--pending'}}">{{meta.sampleNo || '待录入'}}</text></view>
        <view class="row"><text>姓名：</text><text>{{meta.contactName || '—'}}</text></view>
        <view class="row"><text>取样时间：</text><text>{{meta.sampleTime || '—'}}</text></view>
        <view class="row"><text>地址：</text><text class="ellipsis">{{meta.address || '—'}}</text></view>
        <view class="row"><text>提交时间：</text><text>{{detail && detail.submitTime || '—'}}</text></view>
        <view class="row"><text>报告时间：</text><text>{{detail && detail.reportedAt || '—'}}</text></view>
        <view class="row"><text>状态：</text><text class="status status-{{detail && detail.status}}">{{detail && detail.statusText || '—'}}</text></view>
      </view>

      <view class="section" wx:if="{{detail && detail.status === 'completed'}}">
        <view class="section-title">结果矩阵</view>
        <view class="summary-line">阳性合计：<text class="pos-num">{{positiveCount}}</text></view>
        <view class="pos-tags" wx:if="{{positives && positives.length}}">
          <text class="pos-tag" wx:for="{{positives}}" wx:key="{{item}}">{{item}}</text>
        </view>
        <view class="legend">
          <text class="legend-label">强度图例：</text>
          <text class="level-badge level-weak">弱</text>
          <text class="level-badge level-medium">中</text>
          <text class="level-badge level-strong">强</text>
          <text class="level-badge level-null">空</text>
        </view>
        <block wx:for="{{tables}}" wx:key="{{item.key}}">
          <view class="group-title">{{item.title}}</view>
          <scroll-view scroll-x="true" class="table-scroll">
            <view class="table-row table-head">
              <view class="cell cell--head" wx:for="{{item.headers}}" wx:key="{{item}}">{{item}}</view>
            </view>
            <view class="table-row">
              <view class="cell" wx:for="{{item.cells}}" wx:key="{{item.code}}">
                <text class="level-badge level-{{item.level || 'null'}}">{{item.levelText}}</text>
              </view>
            </view>
          </scroll-view>
        </block>
      </view>

      <view class="section pending-tip" wx:if="{{!(detail && detail.status === 'completed')}}">
        <view class="section-title">检测进度</view>
        <view class="pending-box">
          <text class="pending-title">检测进行中</text>
          <text class="pending-text">实验室正在处理样品，完成后将第一时间通过小程序通知您。</text>
          <button wx:if="{{detail && detail.status === 'pending'}}" class="u-btn u-btn-primary u-btn--md u-btn--pill u-btn-block" bindtap="goGuide">查看邮寄说明</button>
        </view>
      </view>

      <!-- 推荐（预留） -->
      <view class="section" wx:if="{{recs && recs.length}}">
        <view class="section-title">推荐</view>
        <view class="promo-box" wx:for="{{recs}}" wx:key="index" bindtap="onTapRec" data-index="{{index}}">
          <text class="rec-badge">{{item.source==='enterprise' ? '企业推荐' : '平台推荐'}}</text>
          <text class="rec-name">{{item.productName}}</text>
          <text class="rec-brief">{{item.brief}}</text>
        </view>
      </view>

    </view>
  </view>
</view>
