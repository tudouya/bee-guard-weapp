<view class="product-detail">
  <view wx:if="{{loading}}" class="product-loading-card">产品信息加载中...</view>

  <view wx:if="{{errorMessage && !loading}}" class="product-error">
    <text>{{errorMessage}}</text>
    <view class="u-btn u-btn-primary u-btn--sm product-error__btn" bindtap="handleRetry">重新加载</view>
  </view>

  <view wx:if="{{!loading && detail}}">
    <view class="product-banner" wx:if="{{displayImages && displayImages.length}}">
      <swiper
        class="product-banner__swiper"
        indicator-dots="{{displayImages.length > 1}}"
        circular="{{displayImages.length > 1}}"
        autoplay="{{displayImages.length > 1}}"
        interval="5000"
        current="{{activeImageIndex}}"
        bindchange="handleImageChange"
      >
        <swiper-item wx:for="{{displayImages}}" wx:key="*this">
          <image class="product-banner__image" src="{{item}}" mode="aspectFill"></image>
        </swiper-item>
      </swiper>
      <view class="product-banner__badge">{{detail.source==='enterprise' ? (detail.sourceLabel || '企业推荐') : '平台精选'}}</view>
      <view class="product-banner__counter" wx:if="{{displayImages.length > 1}}">{{activeImageIndex + 1}} / {{displayImages.length}}</view>
    </view>

    <view class="product-base">
      <view class="product-base__title">{{detail.name}}</view>
      <view class="product-base__subtitle">{{detail.subtitle}}</view>
      <view class="product-base__meta">
        <text class="product-base__price">{{detail.priceRange}}</text>
        <view class="u-btn u-btn-primary u-btn--xs u-btn--pill" bindtap="handleCopyPrice">复制价格</view>
      </view>
      <view class="product-base__meta" wx:if="{{detail.registrationNo}}">
        <text class="product-base__label">注册证号</text>
        <text class="product-base__value">{{detail.registrationNo}}</text>
      </view>
    </view>

    <view class="product-section" wx:if="{{detail.recommendedFor && detail.recommendedFor.length}}">
      <view class="product-section__title">适用场景</view>
      <view class="product-section__chips">
        <view class="product-section__chip" wx:for="{{detail.recommendedFor}}" wx:key="index">{{item}}</view>
      </view>
    </view>

    <view class="product-section" wx:if="{{detail.highlights && detail.highlights.length}}">
      <view class="product-section__title">产品亮点</view>
      <view class="product-list-text" wx:for="{{detail.highlights}}" wx:key="index">• {{item}}</view>
    </view>

    <view class="product-section" wx:if="{{detail.composition && detail.composition.length}}">
      <view class="product-section__title">套餐组成 / 核心成分</view>
      <view class="product-list-text" wx:for="{{detail.composition}}" wx:key="index">• {{item}}</view>
    </view>

    <view class="product-section" wx:if="{{detail.usageSteps && detail.usageSteps.length}}">
      <view class="product-section__title">使用方案</view>
      <view class="product-step" wx:for="{{detail.usageSteps}}" wx:key="index">
        <view class="product-step__index">{{index + 1}}</view>
        <view class="product-step__body">
          <view class="product-step__title">{{item.title}}</view>
          <view class="product-step__desc">{{item.detail}}</view>
        </view>
      </view>
    </view>

    <view class="product-section" wx:if="{{detail.notice && detail.notice.length}}">
      <view class="product-section__title">注意事项</view>
      <view class="product-list-text" wx:for="{{detail.notice}}" wx:key="index">• {{item}}</view>
    </view>

    <view class="product-section" wx:if="{{detail.faq && detail.faq.length}}">
      <view class="product-section__title">常见问答</view>
      <view class="product-faq" wx:for="{{detail.faq}}" wx:key="index">
        <view class="product-faq__q">Q：{{item.q}}</view>
        <view class="product-faq__a">A：{{item.a}}</view>
      </view>
    </view>

    <view class="product-contact" wx:if="{{detail.contact}}">
      <view class="product-section__title">联系方式</view>
      <view class="product-contact__meta">
        <view wx:if="{{detail.contact.company}}" class="product-contact__name">企业名称：{{detail.contact.company}}</view>
        <view wx:if="{{detail.contact.phone}}">电话：{{detail.contact.phone}}</view>
        <view wx:if="{{detail.contact.wechat}}">微信：{{detail.contact.wechat}}</view>
        <view wx:if="{{detail.contact.website}}">官网：{{detail.contact.website}}</view>
      </view>
      <view class="product-contact__actions">
        <view wx:if="{{detail.contact.phone}}" class="u-btn u-btn-primary u-btn--sm u-btn--pill" bindtap="handleCallEnterprise">电话咨询</view>
        <view wx:if="{{detail.contact.wechat}}" class="u-btn u-btn-primary u-btn--sm u-btn--pill" bindtap="handleCopyWechat">复制微信</view>
        <view wx:if="{{detail.contact.website}}" class="u-btn u-btn-primary u-btn--sm u-btn--pill" bindtap="handleCopyLink">复制官网链接</view>
      </view>
      <view class="product-contact__hint">如需定制化服务，可通过以上方式联系获取详细方案。</view>
    </view>

    <view class="product-contact product-contact--platform" wx:if="{{!detail.contact}}">
      <view class="product-section__title">平台客服</view>
      <view class="product-contact__hint">平台推荐商品由官方严选提供，具体发货、售后信息将在正式接入后同步。您也可在“我的-客服咨询”中联系我们。</view>
    </view>
  </view>
</view>
